<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Dashboard</title>
		<link rel="icon" type="image/png" href="favicon.png" />
		<link rel="manifest" href="manifest.json" />

		<!-- Font -->
		<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lilita+One&display=swap" />
		<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap" />

		<!-- Style -->
		<link rel="stylesheet" href="bootstrap.min.css" />

		<!-- Script -->
		<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
		<script src="bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Faker/3.1.0/faker.min.js"></script>
		<script src="socket.io/socket.io.js"></script>

		<style>
			body {
				padding: 16px;
				padding-bottom: 70px;
			}

			.alert {
				cursor: pointer;
			}

			textarea {
				resize: none;
				padding: 20px;
				border: none;
				overflow: auto;
				outline: none;
				width: 100%;
				height: 70px;
				border-top: 3px solid #eeeeee;
			}
		</style>
	</head>

	<body>
		<textarea rows="1" autocorrect="off" class="fixed-bottom" placeholder="Message ..." onkeydown="if(event.keyCode == 13) return sendMessage();"></textarea>
	</body>

	<script>
		let socket

		$(() => {
			socket = io()

			socket.on("openAlert", function (data) {
				$("body").append(window[data.type](data))
				bindCloseEvent(data.id)
			})

			socket.on("openMessage", function (data) {
				$("body").append(msg(data))
			})
		})

		function bindCloseEvent(id) {
			$("#" + id).on("closed.bs.alert", function () {
				const id = $(this).attr("id")
				if (!id) return
				socket.emit("closeAlert", { id })
			})
		}

		function msg(data) {
			return `
				<div class="alert border alert-dismissible d-flex align-items-center" role="alert" class="close" data-dismiss="alert">
					<img src="comment-solid.svg" height="30px" class="mr-4 a" />
					<div>
						${data.title}<br />
						${data.message}
					</div>
				</div>
			`
		}

		function bit(data) {
			return `
				<div id="${data.id}" class="alert alert-primary alert-dismissible d-flex align-items-center" role="alert" class="close" data-dismiss="alert">
					<img src="heart-solid.svg" height="30px" class="mr-4 a" />
					<div>
						${data.title}<br />
						${data.message ? "<br />" + data.message : ""}
					</div>
				</div>
			`
		}

		function sub(data) {
			return `
				<div id="${data.id}" class="alert alert-success alert-dismissible d-flex align-items-center" role="alert" class="close" data-dismiss="alert">
					<img src="fire-solid.svg" height="30px" class="mr-4" />
					<div>
						${data.title}
						${data.message ? "<br />" + data.message : ""}
					</div>
				</div>
			`
		}

		function raid(data) {
			return `
				<div id="${data.id}" class="alert alert-danger alert-dismissible d-flex align-items-center" role="alert" class="close" data-dismiss="alert">
					<img src="bolt-solid.svg" height="30px" class="mr-4" />
					<div>
						${data.title}
					</div>
				</div>
			`
		}

		function sendMessage() {
			const textarea = $("textarea")
			if (textarea.val()) {
				socket.emit("sendMessage", { message: textarea.val() })
				textarea.val("")
			}
			return false
		}
	</script>
</html>
